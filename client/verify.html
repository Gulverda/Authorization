<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Email Verification</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style type="text/css">
    body, #body_table {
      height: 100% !important;
      width: 100% !important;
      margin: 0;
      padding: 0;
      background-color: #f4f7f6;
      font-family: 'Inter', sans-serif;
      -webkit-text-size-adjust: 100%;
      -ms-text-size-adjust: 100%;
    }

    table {
      border-collapse: collapse;
      mso-table-lspace: 0pt;
      mso-table-rspace: 0pt;
    }

    td {
      padding: 0;
    }

    .container {
      width: 100%;
      max-width: 500px;
      margin: 0 auto;
      padding: 20px;
      background-color: #ffffff;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
    }

    .header,
    .bottom {
      position: relative;
      background-color: #B9EAD499;
      overflow: hidden;
      text-align: center;
      padding-top: 30px;
      padding-bottom: 30px;
    }

    .header::before,
    .bottom::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-size: cover;
      background-repeat: no-repeat;
      background-image: url('./assets/road.svg');
      filter: blur(0.6px);
      opacity: 0.8;
      z-index: 0;
    }

    .header > *,
    .bottom > * {
      position: relative;
      z-index: 1;
    }

    .header img.logo {
      max-width: 150px;
      height: auto;
      display: block;
      margin: 0 auto;
      border-radius: 8px;
    }

    .content {
      padding: 20px 0;
      text-align: center;
      color: #555555;
      line-height: 1.6;
    }

    .content h2 {
      color: #218658;
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 15px;
    }

    .content p {
      margin-bottom: 15px;
      font-size: 16px;
    }

    .button {
      display: inline-block;
      background-color: #218658;
      color: #ffffff !important;
      padding: 14px 28px;
      border: none;
      border-radius: 6px;
      text-decoration: none;
      font-weight: 600;
      font-size: 18px;
      margin: 20px auto;
      transition: background-color 0.3s ease;
      cursor: pointer;
    }

    .button:hover {
      background-color: #1a6e47;
    }

    .status-message {
      margin-top: 20px;
      padding: 10px;
      border-radius: 6px;
      font-weight: 600;
      min-height: 20px; 
    }

    .status-message.success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .status-message.error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .status-message.info {
      background-color: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }

    .footer {
      text-align: center;
      padding-top: 20px;
      color: #888888;
      font-size: 12px;
      line-height: 1.5;
      border-top: 1px solid #eeeeee;
      margin-top: 20px;
    }

    .footer a {
      color: #218658;
      text-decoration: none;
    }

    .social-icons {
      margin-top: 10px;
    }

    .social-icon-img {
      border: 0;
      outline: none;
      text-decoration: none;
      display: inline-block;
      width: 24px;
      height: 24px;
    }

    @media screen and (max-width: 600px) {
      .container {
        width: 100% !important;
        padding: 10px !important;
      }
      .header h1 {
        font-size: 20px !important;
      }
      .content h2 {
        font-size: 24px !important;
      }
      .content p {
        font-size: 14px !important;
      }
      .button {
        padding: 12px 24px !important;
        font-size: 16px !important;
      }
    }
  </style>
</head>
<body>
  <table border="0" cellpadding="0" cellspacing="0" width="100%" id="body_table">
    <tr>
      <td align="center" valign="top">
        <table border="0" cellpadding="0" cellspacing="0" class="container">
          <tr>
            <td align="center" class="header">
              <img src="./assets/logo.svg" class="logo" alt="PARKLIVE Logo">
            </td>
          </tr>
          <tr>
            <td align="center" class="content" style="padding: 30px;">
              <h2>Verify Your Email Address</h2>
              <p>
                Thank you for registering with <a href="[YOUR_WEBSITE_HOMEPAGE_LINK]" style="color: #218658; text-decoration: none;">PARKLIVE</a>! To complete your registration and activate your account, please verify your email address by clicking the button below:
              </p>
              <button class="button" id="verifyButton" onclick="verifyEmail()">
                Verify Email Address
              </button>
              <div id="statusMessage" class="status-message"></div>
              <p style="margin-top: 20px; font-size: 14px; color: #777777;">
                If you did not request this email, please ignore it or contact our support team.
              </p>
              <p style="font-size: 14px; color: #777777;">
                This link will expire in 24 hours.
              </p>
            </td>
          </tr>
          <tr>
            <td align="center" class="footer bottom">
              <p>
                &copy; 2025 PARKLIVE. All rights reserved.<br>
                Tbilisi, Georgia<br>
                <a href="[YOUR_WEBSITE_LINK]">Our Website</a> |
                <a href="[UNSUBSCRIBE_LINK_OPTIONAL]">Unsubscribe</a>
              </p>
              <div class="social-icons">
                <a href="[FACEBOOK_LINK]">
                  <img src="https://placehold.co/24x24/218658/ffffff?text=F" alt="Facebook" class="social-icon-img">
                </a>
                &nbsp;
                <a href="[TWITTER_LINK]">
                  <img src="https://placehold.co/24x24/218658/ffffff?text=T" alt="Twitter" class="social-icon-img">
                </a>
                &nbsp;
                <a href="[LINKEDIN_LINK]">
                  <img src="https://placehold.co/24x24/218658/ffffff?text=L" alt="LinkedIn" class="social-icon-img">
                </a>
              </div>
            </td>
          </tr>
        </table>
      </td>
    </tr>
  </table>

  <script>
    function getTokenFromURL() {
      const params = new URLSearchParams(window.location.search);
      return params.get('token');
    }

    function getVerifiedStatus() {
      const params = new URLSearchParams(window.location.search);
      return params.get('verified');
    }

    async function verifyEmail() {
      const token = getTokenFromURL();
      const statusMessageDiv = document.getElementById('statusMessage');
      const verifyButton = document.getElementById('verifyButton');

      verifyButton.disabled = true;
      verifyButton.style.opacity = '0.7';
      verifyButton.style.cursor = 'not-allowed';

      if (!token) {
        statusMessageDiv.innerText = "Verification token is missing. Please ensure you clicked the complete link from your email.";
        statusMessageDiv.className = "status-message error";
        verifyButton.disabled = disabled;
        verifyButton.style.opacity = '1';
        verifyButton.style.cursor = 'pointer';
        return;
      }

      statusMessageDiv.innerText = "Verifying your email, please wait...";
      statusMessageDiv.className = "status-message info";

      try {
        const response = await fetch(`http://localhost:5000/api/auth/verify?token=${token}`, {
          method: 'GET',
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json',
          }
        });

        if (response.ok) {
          let result;
          const contentType = response.headers.get('content-type');

          if (contentType && contentType.includes('application/json')) {
            result = await response.json();
          } else {
            result = { success: true, message: 'Email verified successfully!' };
          }

          if (result.success !== false) {
            statusMessageDiv.innerText = "✓ Your email has been successfully verified! Redirecting to your account...";
            statusMessageDiv.className = "status-message success";

            setTimeout(() => {
              window.location.href = '[YOUR_DASHBOARD_URL_AFTER_VERIFICATION]'; 
            }, 2000);
          } else {
            statusMessageDiv.innerText = "❌ " + (result.message || "Verification failed. The token may be expired or invalid.");
            statusMessageDiv.className = "status-message error";
            verifyButton.disabled = false; 
            verifyButton.style.opacity = '1';
            verifyButton.style.cursor = 'pointer';
          }
        } else {
          const errorResult = await response.json().catch(() => ({})); 
          statusMessageDiv.innerText = "❌ " + (errorResult.message || "Verification failed. Please try again or contact support.");
          statusMessageDiv.className = "status-message error";
          verifyButton.disabled = false; 
          verifyButton.style.opacity = '1';
          verifyButton.style.cursor = 'pointer';
        }

      } catch (error) {
        console.error('Verification error:', error);
        statusMessageDiv.innerText = "❌ A network error occurred. Please check your internet connection and try again.";
        statusMessageDiv.className = "status-message error";
        verifyButton.disabled = false; 
        verifyButton.style.opacity = '1';
        verifyButton.style.cursor = 'pointer';

        if (token) {
          setTimeout(() => {
            statusMessageDiv.innerHTML += `<br><br><strong>Alternative:</strong> Please contact support with your verification token: <br><code style="background: #f0f0f0; padding: 2px 4px; border-radius: 3px; font-size: 12px; word-break: break-all;">${token}</code>`;
          }, 1000);
        }
      }
    }

    window.onload = function() {
      const verified = getVerifiedStatus();
      const token = getTokenFromURL();
      const statusMessageDiv = document.getElementById('statusMessage');
      const verifyButton = document.getElementById('verifyButton');

      if (verified === 'true') {
        statusMessageDiv.innerText = "✓ Your email has been successfully verified! Redirecting to your account...";
        statusMessageDiv.className = "status-message success";
        verifyButton.style.display = 'none'; 
        setTimeout(() => {
          window.location.href = '[YOUR_DASHBOARD_URL_AFTER_VERIFICATION]'; 
        }, 2000);
      } else if (!token) {
        statusMessageDiv.innerText = "To verify your email, please click the 'Verify Email Address' button above.";
        statusMessageDiv.className = "status-message info";
      } else {
        statusMessageDiv.innerText = "Click the button below to verify your email address.";
        statusMessageDiv.className = "status-message info";
      }
    };
  </script>
</body>
</html>